"use client";
import { useTheme } from "next-themes";
import { useLayoutEffect, useState } from "react";

const ThemeSwitcher = () => {
  const { theme, setTheme } = useTheme();
  const [mounted, setMounted] = useState(false); // to prevent hydration error

  useLayoutEffect(() => {
    setMounted(true);
    const savedTheme = localStorage.getItem("theme");
    let newTheme: "light" | "dark" = "light";
    if (
      savedTheme === "dark" ||
      (!savedTheme && window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
      newTheme = "dark";
    }
    setTheme(newTheme);
  }, []);

  const toggleTheme = () => {
    setTheme((prevTheme) => {
      const newTheme = prevTheme === "dark" ? "light" : "dark";

      localStorage.setItem("theme", newTheme);
      return newTheme;
    });
  };

  if (!mounted) {
    return null;
  }

  return (
    <button
      className="absolute -top-5 -right-5 cursor-pointer text-xs opacity-30"
      onClick={toggleTheme}
    >
      {theme === "dark" ? (
        <svg
          width="48"
          height="48"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g clipPath="url(#clip0_392_16)">
            <mask
              id="mask0_392_16"
              maskUnits="userSpaceOnUse"
              x="0"
              y="0"
              width="24"
              height="24"
            >
              <path d="M0 0H24V24H0V0Z" fill="white" />
            </mask>
            <g mask="url(#mask0_392_16)">
              <path
                d="M12 0C12.2652 0 12.5196 0.105357 12.7071 0.292893C12.8946 0.48043 13 0.734784 13 1V3C13 3.26522 12.8946 3.51957 12.7071 3.70711C12.5196 3.89464 12.2652 4 12 4C11.7348 4 11.4804 3.89464 11.2929 3.70711C11.1054 3.51957 11 3.26522 11 3V1C11 0.734784 11.1054 0.48043 11.2929 0.292893C11.4804 0.105357 11.7348 0 12 0ZM0 12C0 11.7348 0.105357 11.4804 0.292893 11.2929C0.48043 11.1054 0.734784 11 1 11H3C3.26522 11 3.51957 11.1054 3.70711 11.2929C3.89464 11.4804 4 11.7348 4 12C4 12.2652 3.89464 12.5196 3.70711 12.7071C3.51957 12.8946 3.26522 13 3 13H1C0.734784 13 0.48043 12.8946 0.292893 12.7071C0.105357 12.5196 0 12.2652 0 12ZM21 11C20.7348 11 20.4804 11.1054 20.2929 11.2929C20.1054 11.4804 20 11.7348 20 12C20 12.2652 20.1054 12.5196 20.2929 12.7071C20.4804 12.8946 20.7348 13 21 13H23C23.2652 13 23.5196 12.8946 23.7071 12.7071C23.8946 12.5196 24 12.2652 24 12C24 11.7348 23.8946 11.4804 23.7071 11.2929C23.5196 11.1054 23.2652 11 23 11H21ZM13 21C13 20.7348 12.8946 20.4804 12.7071 20.2929C12.5196 20.1054 12.2652 20 12 20C11.7348 20 11.4804 20.1054 11.2929 20.2929C11.1054 20.4804 11 20.7348 11 21V23C11 23.2652 11.1054 23.5196 11.2929 23.7071C11.4804 23.8946 11.7348 24 12 24C12.2652 24 12.5196 23.8946 12.7071 23.7071C12.8946 23.5196 13 23.2652 13 23V21ZM6.343 17.657C6.53047 17.8445 6.63579 18.0988 6.63579 18.364C6.63579 18.6292 6.53047 18.8835 6.343 19.071L4.93 20.485C4.83775 20.5805 4.72741 20.6567 4.6054 20.7091C4.4834 20.7615 4.35218 20.7891 4.2194 20.7903C4.08662 20.7914 3.95494 20.7661 3.83205 20.7158C3.70915 20.6655 3.5975 20.5913 3.50361 20.4974C3.40971 20.4035 3.33546 20.2919 3.28518 20.169C3.2349 20.0461 3.2096 19.9144 3.21075 19.7816C3.2119 19.6488 3.23949 19.5176 3.2919 19.3956C3.34431 19.2736 3.42049 19.1632 3.516 19.071L4.93 17.657C5.11753 17.4695 5.37184 17.3642 5.637 17.3642C5.90216 17.3642 6.15547 17.4695 6.343 17.657ZM20.485 3.515C20.6725 3.70253 20.7778 3.95684 20.7778 4.222C20.7778 4.48716 20.6725 4.74147 20.485 4.929L19.071 6.343C18.9788 6.43851 18.8684 6.51469 18.7464 6.5671C18.6244 6.61951 18.4932 6.6471 18.3604 6.64825C18.2276 6.6494 18.0959 6.6241 17.973 6.57382C17.8501 6.52354 17.7385 6.44929 17.6446 6.35539C17.5507 6.2615 17.4765 6.14985 17.4262 6.02695C17.3759 5.90406 17.3506 5.77238 17.3517 5.6396C17.3529 5.50682 17.3805 5.3756 17.4329 5.2536C17.4853 5.13159 17.5615 5.02125 17.657 4.929L19.071 3.515C19.2585 3.32753 19.5128 3.22221 19.778 3.22221C20.0432 3.22221 20.2975 3.32753 20.485 3.515ZM3.515 3.515C3.70253 3.32753 3.95684 3.22221 4.222 3.22221C4.48716 3.22221 4.74147 3.32753 4.929 3.515L6.343 4.929C6.44074 5.02066 6.51907 5.13102 6.57332 5.25354C6.62758 5.37606 6.65666 5.50824 6.65883 5.64221C6.66101 5.77619 6.63624 5.90924 6.58599 6.03346C6.53574 6.15767 6.46104 6.27052 6.36632 6.36531C6.27161 6.46009 6.15881 6.53487 6.03463 6.58521C5.91045 6.63554 5.77742 6.66041 5.64344 6.65833C5.50946 6.65625 5.37726 6.62726 5.25471 6.57309C5.13215 6.51893 5.02173 6.44068 4.93 6.343L3.515 4.93C3.32753 4.74247 3.22221 4.48816 3.22221 4.223C3.22221 3.95784 3.32753 3.70253 3.515 3.515ZM17.657 17.657C17.8445 17.4695 18.0988 17.3642 18.364 17.3642C18.6292 17.3642 18.8835 17.4695 19.071 17.657L20.485 19.071C20.5805 19.1632 20.6567 19.2736 20.7091 19.3956C20.7615 19.5176 20.7891 19.6488 20.7903 19.7816C20.7914 19.9144 20.7661 20.0461 20.7158 20.169C20.6655 20.2919 20.5913 20.4035 20.4974 20.4974C20.4035 20.5913 20.2919 20.6655 20.169 20.7158C20.0461 20.7661 19.9144 20.7914 19.7816 20.7903C19.6488 20.7891 19.5176 20.7615 19.3956 20.7091C19.2736 20.6567 19.1632 20.5805 19.071 20.485L17.657 19.071C17.4695 18.8835 17.3642 18.6292 17.3642 18.364C17.3642 18.0988 17.4695 17.8445 17.657 17.657ZM5 12C5 11.0807 5.18106 10.1705 5.53284 9.32122C5.88463 8.47194 6.40024 7.70026 7.05025 7.05025C7.70026 6.40024 8.47194 5.88463 9.32122 5.53284C10.1705 5.18106 11.0807 5 12 5C12.9193 5 13.8295 5.18106 14.6788 5.53284C15.5281 5.88463 16.2997 6.40024 16.9497 7.05025C17.5998 7.70026 18.1154 8.47194 18.4672 9.32122C18.8189 10.1705 19 11.0807 19 12C19 13.8565 18.2625 15.637 16.9497 16.9497C15.637 18.2625 13.8565 19 12 19C10.1435 19 8.36301 18.2625 7.05025 16.9497C5.7375 15.637 5 13.8565 5 12Z"
                fill="#F0EDF2"
              />
            </g>
          </g>
          <defs>
            <clipPath id="clip0_392_16">
              <rect width="24" height="24" fill="white" />
            </clipPath>
          </defs>
        </svg>
      ) : (
        <svg
          width="48"
          height="48"
          viewBox="0 0 16 16"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M8.00696 0.5C12.1495 0.5 15.507 3.858 15.507 8C15.507 12.142 12.1495 15.5 8.00696 15.5C3.86446 15.5 0.506958 12.142 0.506958 8C0.506958 3.858 3.86496 0.5 8.00696 0.5ZM2.74546 11.817C3.41628 12.7405 4.31761 13.4718 5.35946 13.938C5.50917 13.5881 5.54074 13.1989 5.44938 12.8295C5.35803 12.46 5.14872 12.1304 4.85319 11.8906C4.55766 11.6509 4.19201 11.5139 3.81166 11.5006C3.43132 11.4874 3.05701 11.5984 2.74546 11.817ZM12.1665 12.9955C12.9674 12.3282 13.5966 11.4787 14.0015 10.518C13.6885 10.4725 13.3691 10.5126 13.0771 10.6342C12.7851 10.7557 12.5316 10.9541 12.3433 11.2082C12.1551 11.4623 12.0393 11.7627 12.0081 12.0774C11.977 12.3921 12.0317 12.7094 12.1665 12.9955ZM7.74996 3.5C7.84845 3.5 7.94598 3.4806 8.03697 3.44291C8.12797 3.40522 8.21064 3.34997 8.28029 3.28033C8.34993 3.21069 8.40518 3.12801 8.44287 3.03701C8.48056 2.94602 8.49996 2.84849 8.49996 2.75C8.49996 2.65151 8.48056 2.55398 8.44287 2.46299C8.40518 2.37199 8.34993 2.28931 8.28029 2.21967C8.21064 2.15003 8.12797 2.09478 8.03697 2.05709C7.94598 2.0194 7.84845 2 7.74996 2C7.55105 2 7.36028 2.07902 7.21963 2.21967C7.07898 2.36032 6.99996 2.55109 6.99996 2.75C6.99996 2.94891 7.07898 3.13968 7.21963 3.28033C7.36028 3.42098 7.55105 3.5 7.74996 3.5ZM4.74996 8C5.21409 8 5.65921 7.81563 5.98739 7.48744C6.31558 7.15925 6.49996 6.71413 6.49996 6.25C6.49996 5.78587 6.31558 5.34075 5.98739 5.01256C5.65921 4.68437 5.21409 4.5 4.74996 4.5C4.28583 4.5 3.84071 4.68437 3.51252 5.01256C3.18433 5.34075 2.99996 5.78587 2.99996 6.25C2.99996 6.71413 3.18433 7.15925 3.51252 7.48744C3.84071 7.81563 4.28583 8 4.74996 8ZM12.5 5.75C12.5 5.41848 12.3683 5.10054 12.1338 4.86612C11.8994 4.6317 11.5815 4.5 11.25 4.5C10.9184 4.5 10.6005 4.6317 10.3661 4.86612C10.1317 5.10054 9.99996 5.41848 9.99996 5.75C9.99996 6.08152 10.1317 6.39946 10.3661 6.63388C10.6005 6.8683 10.9184 7 11.25 7C11.5815 7 11.8994 6.8683 12.1338 6.63388C12.3683 6.39946 12.5 6.08152 12.5 5.75ZM9.74996 10.5C10.0815 10.5 10.3994 10.3683 10.6338 10.1339C10.8683 9.89946 11 9.58152 11 9.25C11 8.91848 10.8683 8.60054 10.6338 8.36612C10.3994 8.1317 10.0815 8 9.74996 8C9.41844 8 9.1005 8.1317 8.86607 8.36612C8.63165 8.60054 8.49996 8.91848 8.49996 9.25C8.49996 9.58152 8.63165 9.89946 8.86607 10.1339C9.1005 10.3683 9.41844 10.5 9.74996 10.5Z"
            fill="#F0EDF2"
          />
        </svg>
      )}
    </button>
  );
};

export default ThemeSwitcher;
